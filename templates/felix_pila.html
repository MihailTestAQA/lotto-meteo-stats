{% extends "base.html" %}

{% block title %}Felix Pila - LottoMeteoStats{% endblock %}

{% block content %}
<style>
    /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò –°–¢–†–ê–ù–ò–¶–´ */
    .felix-page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
    .felix-grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
    }

    .felix-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        height: fit-content;
    }

    /* –ò–ª–∏ —Ç–æ—á–Ω–µ–µ - —É–º–µ–Ω—å—à–∞–µ–º –Ω–∞ 20px (5–º–º): */
    .felix-card[style*="grid-column: span 2"] {
        min-height: calc(100% - 30px);
        margin-top: -10px; /* –ü–æ–¥–Ω–∏–º–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ */
    }

    .felix-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
    }

    .felix-card h2 {
        color: #4a5568;
        margin-bottom: 25px;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 12px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f5f9;
    }

    /* –ü–†–û–ì–ù–û–ó –ß–ò–°–ï–õ - –ù–û–í–ê–Ø –°–ï–¢–ö–ê */
    .prediction-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin: 20px 0;
    }

    /* –î–µ–ª–∞–µ–º –ö–û–ù–¢–ï–ô–ù–ï–†–´ –ø–æ–ª–µ–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ */
    .field-container {
        background: #f8fafc;
        border-radius: 15px;
        padding: 20px;
        border: 2px solid #e2e8f0;
        display: flex;
        flex-direction: column;
        
        /* –í–ê–ñ–ù–û: –§–ò–ö–°–ò–†–£–ï–ú –†–ê–ó–ú–ï–†–´ */
        min-height: 300px;  /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        height: 100%;       /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É */
        width: 100%;        /* –ó–∞–Ω–∏–º–∞–µ–º –≤—Å—é —à–∏—Ä–∏–Ω—É —Ä–æ–¥–∏—Ç–µ–ª—è */
        min-width: 250px;   /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
        
        /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
        justify-content: flex-start; /* –∏–ª–∏ center */
    }

    .field-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        color: #4a5568;
        font-weight: 600;
        font-size: 1.1rem;
    }

    /* –°–ï–¢–ö–ê –ß–ò–°–ï–õ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª—è - –∫–≤–∞–¥—Ä–∞—Ç–Ω–∞—è 2x2 */
    .field-numbers {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2 –∫–æ–ª–æ–Ω–∫–∏ */
        grid-template-rows: repeat(2, 1fr);    /* 2 —Å—Ç—Ä–æ–∫–∏ */
        gap: 15px;
        
        /* –î–µ–ª–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã—Å–æ—Ç—ã */
        min-height: 200px;
        height: 100%;
    }

    .field-1 .felix-number-item {
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
    }

    .field-2 .felix-number-item {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    }

    /* –î–µ–ª–∞–µ–º –ö–ê–ñ–î–£–Æ –ö–ê–†–¢–û–ß–ö–£ –° –ß–ò–°–õ–û–ú –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π */
    .felix-number-item {
        /* –î–µ–ª–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç */
        aspect-ratio: 1 / 1; /* –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ! */
        
        /* –ò–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç aspect-ratio */
        min-width: 60px;
        min-height: 60px;
        max-width: 100px;
        max-height: 100px;
        
        /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        
        /* –°—Ç–∏–ª–∏ */
        border-radius: 15px;
        padding: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .felix-number-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .felix-number-value {
        font-size: 1.8rem; /* –£–º–µ–Ω—å—à–∞–µ–º –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        line-height: 1.2;
    }

    .felix-number-prob {
        font-size: 0.8rem; /* –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç */
        color: rgba(255, 255, 255, 0.9);
        margin-top: 5px;
        font-weight: 500;
    }

    .felix-number-rank {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        width: 22px;
        height: 22px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
    }
    /* –§–ò–õ–¨–¢–†–´ */
    .felix-filters-section {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    }

    .felix-filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
    }

    .felix-filter-group {
        margin-bottom: 10px;
    }

    .felix-filter-group label {
        display: block;
        margin-bottom: 8px;
        color: #4a5568;
        font-weight: 500;
        font-size: 0.95rem;
    }

    .felix-filter-control {
        width: 100%;
        padding: 12px 15px;
        border-radius: 10px;
        border: 2px solid #e2e8f0;
        background: #f8fafc;
        color: #4a5568;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .felix-filter-control:focus {
        outline: none;
        border-color: #f39c12;
        background: white;
        box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
    }

    .felix-filter-actions {
        display: flex;
        gap: 15px;
        align-items: flex-end;
    }

    .felix-filter-btn {
        padding: 12px 25px;
        border-radius: 10px;
        border: none;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
    }

    .felix-filter-btn.primary {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        color: white;
    }

    .felix-filter-btn.secondary {
        background: linear-gradient(135deg, #718096 0%, #4a5568 100%);
        color: white;
    }

    .felix-filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* –ò–ù–°–ê–ô–¢–´ */
    .insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .insight-card {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        padding: 25px;
        border-radius: 15px;
        border-left: 5px solid #f39c12;
        transition: all 0.3s ease;
    }

    .insight-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .insight-card i {
        font-size: 2rem;
        color: #f39c12;
        margin-bottom: 15px;
    }

    .insight-card h3 {
        color: #4a5568;
        margin-bottom: 15px;
        font-size: 1.2rem;
    }

    .insight-numbers {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
    }

    .insight-number-badge {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1rem;
    }

    /* –ì–†–ê–§–ò–ö */
    .chart-wrapper {
        min-height: 400px; /* +5–º–º ‚âà 50px –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π 300px */
        height: 100%;
    }

    .chart-container {
        height: 300px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        position: relative;
    }

    /* –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ï –ë–ê–î–ñ–ò */
    .felix-info-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(243, 156, 18, 0.1);
        color: #f39c12;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-top: 15px;
    }

    /* –ò–ù–î–ò–ö–ê–¢–û–†–´ –î–ê–ù–ù–´–• - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –¶–í–ï–¢–ê */
    .data-indicators {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .data-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        border-radius: 10px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .data-indicator.real {
        background: rgba(46, 204, 113, 0.1);
        color: #27ae60;
        border: 1px solid rgba(46, 204, 113, 0.3);
    }

    .data-indicator.demo {
        background: rgba(241, 196, 15, 0.1);
        color: #f39c12;
        border: 1px solid rgba(241, 196, 15, 0.3);
    }

    .data-indicator.api {
        background: rgba(155, 89, 182, 0.1); /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è API */
        color: #8e44ad;
        border: 1px solid rgba(155, 89, 182, 0.3);
    }

    .data-indicator.active {
        background: rgba(46, 204, 113, 0.2); /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö */
        color: #27ae60;
        border: 2px solid #27ae60;
        font-weight: 600;
    }

    .data-indicator i {
        font-size: 1rem;
    }

    /* –°–¢–ê–¢–£–° –ë–ê–† */
    .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 15px;
        margin-bottom: 20px;
        border: 1px solid #e2e8f0;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }

    .status-dot.real {
        background: #2ecc71;
        box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
    }

    .status-dot.demo {
        background: #f39c12;
        box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
    }

    .status-text {
        font-size: 0.9rem;
        font-weight: 500;
        color: #4a5568;
    }

    /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
    @media (max-width: 768px) {
        .felix-page {
            padding: 15px;
        }

        .felix-grid-container {
            grid-template-columns: 1fr;
        }

        .felix-card {
            padding: 20px;
        }

        .prediction-grid {
            grid-template-columns: 1fr;
        }

        .field-numbers {
            grid-template-columns: repeat(4, 1fr);
        }

        .felix-filters-grid {
            grid-template-columns: 1fr;
        }

        .felix-filter-actions {
            flex-direction: column;
        }

        .status-bar {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
    }

    @media (max-width: 480px) {
        .field-numbers {
            grid-template-columns: repeat(2, 1fr);
        }

        .felix-number-value {
            font-size: 1.5rem;
        }
    }

    /* –ê–ù–ò–ú–ê–¶–ò–ò */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .felix-card {
        animation: fadeInUp 0.5s ease-out;
    }

    .felix-card:nth-child(1) { animation-delay: 0.1s; }
    .felix-card:nth-child(2) { animation-delay: 0.2s; }
    .felix-card:nth-child(3) { animation-delay: 0.3s; }

    /* –ó–ê–ì–†–£–ó–ö–ê */
    .loading-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #718096;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f1f5f9;
        border-top: 3px solid #f39c12;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<div class="felix-page">
    <!-- –°–¢–ê–¢–£–° –ë–ê–† -->
    <div class="status-bar">
        <div class="status-item">
            <div class="status-dot" id="dataSourceDot"></div>
            <span class="status-text" id="dataSourceText">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
        </div>
        <div class="status-item">
            <div class="status-dot" id="accuracyDot"></div>
            <span class="status-text" id="accuracyText">–¢–æ—á–Ω–æ—Å—Ç—å: –∑–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <button onclick="refreshAllData()" class="felix-filter-btn primary" style="padding: 8px 15px; font-size: 0.9rem;">
            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ
        </button>
    </div>

    <!-- –§–ò–õ–¨–¢–†–´ -->
    <div class="felix-filters-section">
        <h3><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞ Felix Pila</h3>
        <div class="felix-filters-grid">
            <!-- 1-—è —Å—Ç—Ä–æ–∫–∞: –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
            <div class="felix-filter-group">
                <label><i class="fas fa-cloud-sun"></i> –¢–∏–ø –ø–æ–≥–æ–¥—ã:</label>
                <select id="weatherFilter" class="felix-filter-control">
                    <option value="">–í—Å–µ –ø–æ–≥–æ–¥—ã (–∑–∞–≥—Ä—É–∑–∫–∞...)</option>
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏–º —á–µ—Ä–µ–∑ JavaScript -->
                </select>
            </div>
            
            <div class="felix-filter-group">
                <label><i class="fas fa-thermometer-half"></i> –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</label>
                <select id="tempFilter" class="felix-filter-control">
                    <option value="">–õ—é–±–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="-50_-45">-50¬∞C –¥–æ -45¬∞C</option>
                    <option value="-45_-40">-45¬∞C –¥–æ -40¬∞C</option>
                    <option value="-40_-35">-40¬∞C –¥–æ -35¬∞C</option>
                    <option value="-35_-30">-35¬∞C –¥–æ -30¬∞C</option>
                    <option value="-30_-25">-30¬∞C –¥–æ -25¬∞C</option>
                    <option value="-25_-20">-25¬∞C –¥–æ -20¬∞C</option>
                    <option value="-20_-15">-20¬∞C –¥–æ -15¬∞C</option>
                    <option value="-15_-10">-15¬∞C –¥–æ -10¬∞C</option>
                    <option value="-10_-5">-10¬∞C –¥–æ -5¬∞C</option>
                    <option value="-5_0">-5¬∞C –¥–æ 0¬∞C</option>
                    <option value="0_5">0¬∞C –¥–æ 5¬∞C</option>
                    <option value="5_10">5¬∞C –¥–æ 10¬∞C</option>
                    <option value="10_15">10¬∞C –¥–æ 15¬∞C</option>
                    <option value="15_20">15¬∞C –¥–æ 20¬∞C</option>
                    <option value="20_25">20¬∞C –¥–æ 25¬∞C</option>
                    <option value="25_30">25¬∞C –¥–æ 30¬∞C</option>
                    <option value="30_35">30¬∞C –¥–æ 35¬∞C</option>
                    <option value="35_40">35¬∞C –¥–æ 40¬∞C</option>
                    <option value="40_45">40¬∞C –¥–æ 45¬∞C</option>
                    <option value="45_50">45¬∞C –¥–æ 50¬∞C</option>
                </select>
            </div>
            
            <!-- 2-—è —Å—Ç—Ä–æ–∫–∞: –ù–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
            <div class="felix-filter-group">
                <label><i class="fas fa-tint"></i> –í–ª–∞–∂–Ω–æ—Å—Ç—å:</label>
                <select id="humidityFilter" class="felix-filter-control">
                    <option value="">–õ—é–±–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å</option>
                    <option value="0_10">0-10%</option>
                    <option value="10_20">10-20%</option>
                    <option value="20_30">20-30%</option>
                    <option value="30_40">30-40%</option>
                    <option value="40_50">40-50%</option>
                    <option value="50_60">50-60%</option>
                    <option value="60_70">60-70%</option>
                    <option value="70_80">70-80%</option>
                    <option value="80_90">80-90%</option>
                    <option value="90_100">90-100%</option>
                </select>
            </div>
            
            <div class="felix-filter-group">
                <label><i class="fas fa-tachometer-alt"></i> –î–∞–≤–ª–µ–Ω–∏–µ:</label>
                <select id="pressureFilter" class="felix-filter-control">
                    <option value="">–õ—é–±–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</option>
                    <option value="730_735">730-735 –º–º</option>
                    <option value="735_740">735-740 –º–º</option>
                    <option value="740_745">740-745 –º–º</option>
                    <option value="745_750">745-750 –º–º</option>
                    <option value="750_755">750-755 –º–º</option>
                    <option value="755_760">755-760 –º–º</option>
                    <option value="760_765">760-765 –º–º</option>
                    <option value="765_770">765-770 –º–º</option>
                    <option value="770_775">770-775 –º–º</option>
                </select>
            </div>
            
            <!-- 3-—è —Å—Ç—Ä–æ–∫–∞: –í–µ—Ç–µ—Ä –∏ –õ—É–Ω–∞ -->
            <div class="felix-filter-group">
                <label><i class="fas fa-wind"></i> –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞:</label>
                <select id="windSpeedFilter" class="felix-filter-control">
                    <option value="">–õ—é–±–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å</option>
                    <option value="0_5">0-5 –º/—Å (—à—Ç–∏–ª—å)</option>
                    <option value="5_10">5-10 –º/—Å (–ª–µ–≥–∫–∏–π)</option>
                    <option value="10_15">10-15 –º/—Å (—É–º–µ—Ä–µ–Ω–Ω—ã–π)</option>
                    <option value="15_20">15-20 –º/—Å (—Å–∏–ª—å–Ω—ã–π)</option>
                    <option value="20_25">20-25 –º/—Å (—à—Ç–æ—Ä–º)</option>
                    <option value="25_30">25-30 –º/—Å (—É—Ä–∞–≥–∞–Ω)</option>
                    <option value="30_35">30-35 –º/—Å</option>
                    <option value="35_40">35-40 –º/—Å</option>
                </select>
            </div>
            
            <div class="felix-filter-group">
                <label><i class="fas fa-compass"></i> –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞:</label>
                <select id="windDirectionFilter" class="felix-filter-control">
                    <option value="">–õ—é–±–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</option>
                    <option value="—Å–µ–≤–µ—Ä">–°–µ–≤–µ—Ä (N)</option>
                    <option value="—Å–µ–≤–µ—Ä–æ-–≤–æ—Å—Ç–æ–∫">–°–µ–≤–µ—Ä–æ-–≤–æ—Å—Ç–æ–∫ (NE)</option>
                    <option value="–≤–æ—Å—Ç–æ–∫">–í–æ—Å—Ç–æ–∫ (E)</option>
                    <option value="—é–≥–æ-–≤–æ—Å—Ç–æ–∫">–Æ–≥–æ-–≤–æ—Å—Ç–æ–∫ (SE)</option>
                    <option value="—é–≥">–Æ–≥ (S)</option>
                    <option value="—é–≥–æ-–∑–∞–ø–∞–¥">–Æ–≥–æ-–∑–∞–ø–∞–¥ (SW)</option>
                    <option value="–∑–∞–ø–∞–¥">–ó–∞–ø–∞–¥ (W)</option>
                    <option value="—Å–µ–≤–µ—Ä–æ-–∑–∞–ø–∞–¥">–°–µ–≤–µ—Ä–æ-–∑–∞–ø–∞–¥ (NW)</option>
                </select>
            </div>
            
            <div class="felix-filter-group">
                <label><i class="fas fa-moon"></i> –§–∞–∑–∞ –õ—É–Ω—ã:</label>
                <select id="moonFilter" class="felix-filter-control">
                    <option value="">–õ—é–±–∞—è —Ñ–∞–∑–∞</option>
                    <option value="new">–ù–æ–≤–æ–ª—É–Ω–∏–µ</option>
                    <option value="waxing">–†–∞—Å—Ç—É—â–∞—è</option>
                    <option value="full">–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ</option>
                    <option value="waning">–£–±—ã–≤–∞—é—â–∞—è</option>
                </select>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="felix-filter-actions">
                <button onclick="applyAnalysis()" class="felix-filter-btn primary">
                    <i class="fas fa-filter"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
                <button onclick="resetFelixFilters()" class="felix-filter-btn secondary">
                    <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ
                </button>
            </div>
        </div>
        
        <!-- –ò–ù–î–ò–ö–ê–¢–û–†–´ –î–ê–ù–ù–´–• -->
        <div class="data-indicators">
            <div class="data-indicator api" id="dbIndicator">
                <i class="fas fa-database"></i>
                <span>–ë–î: –ø—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="data-indicator api" id="apiIndicator">
                <i class="fas fa-server"></i>
                <span>API: –ø—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="data-indicator demo" id="demoIndicator">
                <i class="fas fa-vial"></i>
                <span>–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</span>
            </div>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–´–ï –ö–ê–†–¢–û–ß–ö–ò -->
    <div class="felix-grid-container">
        <!-- –ü–†–û–ì–ù–û–ó –ù–ê –û–°–ù–û–í–ï –ü–û–ì–û–î–´ - –ù–û–í–´–ô –î–ò–ó–ê–ô–ù -->
        <div class="felix-card">
            <h2><i class="fas fa-crystal-ball"></i> –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2>
            <p style="color: #718096; margin-bottom: 15px;">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —á–∏—Å–ª–∞ –ø–æ –ø–æ–ª—è–º –ª–æ—Ç–µ—Ä–µ–∏:</p>
            
            <div id="weatherPrediction" class="prediction-grid">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞...</p>
                </div>
            </div>
            
            <div class="felix-info-badge">
                <i class="fas fa-chart-line"></i>
                –¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∞: <span id="accuracyScore">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <!-- –ì–†–ê–§–ò–ö –ê–ù–ê–õ–ò–ó–ê -->
        <div class="felix-card">
            <h2><i class="fas fa-chart-network"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–≤—è–∑–µ–π</h2>
            <div class="chart-wrapper">
                <div class="chart-container">
                    <canvas id="analysisChart"></canvas>
                </div>
            </div>
            <div class="felix-info-badge">
                <i class="fas fa-project-diagram"></i>
                –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ø–æ–≥–æ–¥–∞-—á–∏—Å–ª–∞
            </div>
        </div>

        <!-- –†–ê–°–®–ò–†–ï–ù–ù–´–ï –ò–ù–°–ê–ô–¢–´ -->
        <div class="felix-card" style="grid-column: span 2;">
            <h2><i class="fas fa-chart-network"></i> –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <i class="fas fa-tint"></i>
                    <h3>–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ (>70%):</h3>
                    <div id="highHumidityNumbers" class="insight-numbers">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="insight-card">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–º –¥–∞–≤–ª–µ–Ω–∏–∏ (>760 –º–º):</h3>
                    <div id="highPressureNumbers" class="insight-numbers">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="insight-card">
                    <i class="fas fa-wind"></i>
                    <h3>–ü—Ä–∏ —Å–∏–ª—å–Ω–æ–º –≤–µ—Ç—Ä–µ (>15 –º/—Å):</h3>
                    <div id="strongWindNumbers" class="insight-numbers">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="insight-card">
                    <i class="fas fa-moon"></i>
                    <h3>–í –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ —á–∞—â–µ:</h3>
                    <div id="fullMoonNumbers" class="insight-numbers">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// === –†–ê–ë–û–ß–ò–ô JavaScript –ö–û–î ===

// –ë–õ–û–ö 1: –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ë–ê–ó–û–í–´–ï –§–£–ù–ö–¶–ò–ò
let dataSource = 'demo'; // 'real', 'demo', 'mixed'

/**
 * –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å –±–∞—Ä–∞
 */
function updateStatusBar(source = null) {
    const dataSourceDot = document.getElementById('dataSourceDot');
    const dataSourceText = document.getElementById('dataSourceText');
    const accuracyText = document.getElementById('accuracyText');
    
    if (!dataSourceDot || !dataSourceText) return;
    
    const actualSource = source || dataSource;
    
    if (actualSource === 'real') {
        dataSourceDot.className = 'status-dot real';
        dataSourceText.textContent = '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –∏ API';
        dataSourceText.style.color = '#27ae60';
    } else if (actualSource === 'mixed') {
        dataSourceDot.className = 'status-dot demo';
        dataSourceText.textContent = '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–º–µ—à–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ë–î + –¥–µ–º–æ)';
        dataSourceText.style.color = '#f39c12';
    } else {
        dataSourceDot.className = 'status-dot demo';
        dataSourceText.textContent = '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
        dataSourceText.style.color = '#f39c12';
    }
    
    if (accuracyText) {
        accuracyText.textContent = '–¢–æ—á–Ω–æ—Å—Ç—å: –∑–∞–≥—Ä—É–∑–∫–∞...';
    }
}

/**
 * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∏—Å–µ–ª –≤ –∏–Ω—Å–∞–π—Ç–∞—Ö
 */
function renderNumbers(numbers) {
    if (!Array.isArray(numbers)) return '';
    return numbers.map(num => 
        `<div class="insight-number-badge">${num}</div>`
    ).join('');
}

// –ë–õ–û–ö 2: –§–£–ù–ö–¶–ò–ò –ü–†–û–í–ï–†–ö–ò –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•
async function checkDataSources() {
    console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö...");
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
    try {
        const dbResponse = await fetch('/api/health');
        if (dbResponse.ok) {
            const dbData = await dbResponse.json();
            const dbIndicator = document.getElementById('dbIndicator');
            
            if (dbData.records && dbData.records > 0) {
                dbIndicator.innerHTML = `<i class="fas fa-database"></i><span>–ë–î: ${dbData.records} –∑–∞–ø–∏—Å–µ–π</span>`;
                dbIndicator.className = 'data-indicator real active';
            } else {
                dbIndicator.innerHTML = `<i class="fas fa-database"></i><span>–ë–î: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>`;
                dbIndicator.className = 'data-indicator api';
            }
        }
    } catch (error) {
        document.getElementById('dbIndicator').innerHTML = `<i class="fas fa-database"></i><span>–ë–î: –æ—à–∏–±–∫–∞</span>`;
        document.getElementById('dbIndicator').className = 'data-indicator demo';
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ API Felix Pila
    try {
        const apiResponse = await fetch('/api/felix-pila/predict');
        const apiIndicator = document.getElementById('apiIndicator');
        
        if (apiResponse.ok) {
            const apiData = await apiResponse.json();
            if (apiData.success && apiData.prediction) {
                apiIndicator.innerHTML = `<i class="fas fa-server"></i><span>API: —Ä–∞–±–æ—Ç–∞–µ—Ç</span>`;
                apiIndicator.className = 'data-indicator real active';
                dataSource = 'real';
            } else {
                apiIndicator.innerHTML = `<i class="fas fa-server"></i><span>API: –¥–µ–º–æ</span>`;
                apiIndicator.className = 'data-indicator api';
            }
        } else {
            apiIndicator.innerHTML = `<i class="fas fa-server"></i><span>API: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>`;
            apiIndicator.className = 'data-indicator demo';
        }
    } catch (error) {
        document.getElementById('apiIndicator').innerHTML = `<i class="fas fa-server"></i><span>API: –æ—à–∏–±–∫–∞</span>`;
        document.getElementById('apiIndicator').className = 'data-indicator demo';
    }

    // –î–µ–º–æ-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω
    const demoIndicator = document.getElementById('demoIndicator');
    if (dataSource === 'demo') {
        demoIndicator.className = 'data-indicator demo active';
        demoIndicator.innerHTML = `<i class="fas fa-vial"></i><span>–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ: –∞–∫—Ç–∏–≤–Ω—ã</span>`;
    } else {
        demoIndicator.className = 'data-indicator demo';
        demoIndicator.innerHTML = `<i class="fas fa-vial"></i><span>–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ: –¥–æ—Å—Ç—É–ø–Ω—ã</span>`;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å –±–∞—Ä–∞
    updateStatusBar();
}

// –ë–õ–û–ö 3: –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò –¢–ò–ü–û–í –ü–û–ì–û–î–´
async function loadWeatherTypes() {
    try {
        console.log("üå§Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤ –ø–æ–≥–æ–¥—ã –∏–∑ –ë–î...");
        
        const response = await fetch('/api/weather/types');
        if (!response.ok) {
            console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–ø–æ–≤ –ø–æ–≥–æ–¥—ã");
            initStaticWeatherTypes();
            return;
        }
        
        const data = await response.json();
        if (!data.success || !data.types) {
            console.log("üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∏–ø–∞—Ö –ø–æ–≥–æ–¥—ã");
            initStaticWeatherTypes();
            return;
        }
        
        console.log(`üå§Ô∏è –ù–∞–π–¥–µ–Ω–æ —Ç–∏–ø–æ–≤ –ø–æ–≥–æ–¥—ã: ${data.count}`, data.types);
        
        const weatherSelect = document.getElementById('weatherFilter');
        if (!weatherSelect) {
            console.error("‚ùå –≠–ª–µ–º–µ–Ω—Ç weatherFilter –Ω–µ –Ω–∞–π–¥–µ–Ω");
            return;
        }
        
        const currentValue = weatherSelect.value;
        weatherSelect.innerHTML = '';
        
        const allOption = document.createElement('option');
        allOption.value = '';
        allOption.textContent = '–í—Å–µ –ø–æ–≥–æ–¥—ã';
        weatherSelect.appendChild(allOption);
        
        data.types.forEach(item => {
            const option = document.createElement('option');
            option.value = item.type;
            option.textContent = `${item.type} (${item.count} —Ç–∏—Ä–∞–∂–µ–π)`;
            weatherSelect.appendChild(option);
        });
        
        if (currentValue) weatherSelect.value = currentValue;
        
        console.log("‚úÖ –¢–∏–ø—ã –ø–æ–≥–æ–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
        
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–ø–æ–≤ –ø–æ–≥–æ–¥—ã:", error);
        initStaticWeatherTypes();
    }
}

function initStaticWeatherTypes() {
    const weatherSelect = document.getElementById('weatherFilter');
    if (!weatherSelect) return;
    
    weatherSelect.innerHTML = '<option value="">–í—Å–µ –ø–æ–≥–æ–¥—ã</option>';
    
    ['–ø–∞—Å–º—É—Ä–Ω–æ', '–æ–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏', '–Ω–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥', 
     '–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å', '—è—Å–Ω–æ', '–¥–æ–∂–¥—å', '—Ç—É–º–∞–Ω'].forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        weatherSelect.appendChild(option);
    });
}

// –ë–õ–û–ö 4: –§–£–ù–ö–¶–ò–ò –ü–†–û–ì–ù–û–ó–ê FELIX PILA
/**
 * –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –ü–†–û–ì–ù–û–ó–ê
 */
async function loadFelixPilaPrediction() {
    try {
        console.log("üöÄ –ó–∞–ø—É—Å–∫ loadFelixPilaPrediction()");
        
        // –°–æ–±–∏—Ä–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        const params = new URLSearchParams();
        
        const weatherFilter = document.getElementById('weatherFilter').value;
        const tempFilter = document.getElementById('tempFilter').value;
        const humidityFilter = document.getElementById('humidityFilter').value;
        const pressureFilter = document.getElementById('pressureFilter').value;
        const windSpeedFilter = document.getElementById('windSpeedFilter').value;
        const windDirFilter = document.getElementById('windDirectionFilter').value;
        const moonFilter = document.getElementById('moonFilter').value;
        
        if (weatherFilter) {
            params.append('weather', weatherFilter);
            console.log("üå§Ô∏è –§–∏–ª—å—Ç—Ä –ø–æ–≥–æ–¥—ã:", weatherFilter);
        }
        if (tempFilter) {
            params.append('temp', tempFilter);
            console.log("üå°Ô∏è –§–∏–ª—å—Ç—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã:", tempFilter);
        }
        if (humidityFilter) params.append('humidity', humidityFilter);
        if (pressureFilter) params.append('pressure', pressureFilter);
        if (windSpeedFilter) params.append('wind_speed', windSpeedFilter);
        if (windDirFilter) params.append('wind_dir', windDirFilter);
        if (moonFilter) params.append('moon', moonFilter);
        
        const apiUrl = `/api/felix-pila/predict?${params}`;
        console.log("üì° –ó–∞–ø—Ä–æ—Å –∫ API:", apiUrl);
        
        const response = await fetch(apiUrl);
        console.log("üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:", response.status, response.ok);
        
        if (!response.ok) {
            console.error("‚ùå –û—à–∏–±–∫–∞ HTTP:", response.status);
            displayPrediction(null, true, false);
            return;
        }
        
        const data = await response.json();
        console.log("üì° –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:", data);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
        if (!data.success) {
            console.log("‚ùå API –≤–µ—Ä–Ω—É–ª success: false", data.message);
            displayPrediction(null, true, false);
            return;
        }
        
        if (!data.has_data || !data.prediction) {
            console.log("üìä –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è");
            displayPrediction(null, true, params.toString().length > 0);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç–∞
            setTimeout(() => {
                const accuracyScoreEl = document.getElementById('accuracyScore');
                const accuracyTextEl = document.getElementById('accuracyText');
                
                if (accuracyScoreEl) {
                    accuracyScoreEl.textContent = '0%';
                }
                if (accuracyTextEl) {
                    accuracyTextEl.textContent = '–¢–æ—á–Ω–æ—Å—Ç—å: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                }
            }, 100);
            
            return;
        }
        
        console.log("‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–ª—É—á–µ–Ω:", data.prediction);
        console.log("üìä –¢–∏—Ä–∞–∂–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:", data.filtered_count);
        console.log("üéØ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:", data.confidence);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑
        displayPrediction(data.prediction);
        
        // –ñ–î–ï–ú –ø–æ–∫–∞ displayPrediction —Å–æ–∑–¥–∞—Å—Ç —ç–ª–µ–º–µ–Ω—Ç—ã, –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å
        setTimeout(() => {
            const accuracyScoreEl = document.getElementById('accuracyScore');
            const accuracyTextEl = document.getElementById('accuracyText');
            
            if (accuracyScoreEl) {
                accuracyScoreEl.textContent = Math.round((data.confidence || 0.65) * 100) + '%';
            } else {
                console.error("‚ùå –≠–ª–µ–º–µ–Ω—Ç accuracyScore –Ω–µ –Ω–∞–π–¥–µ–Ω (–µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω)");
            }
            
            if (accuracyTextEl) {
                accuracyTextEl.textContent = `–¢–æ—á–Ω–æ—Å—Ç—å: ${Math.round((data.confidence || 0.65) * 100)}%`;
            } else {
                console.error("‚ùå –≠–ª–µ–º–µ–Ω—Ç accuracyText –Ω–µ –Ω–∞–π–¥–µ–Ω");
            }
        }, 100);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
        if (data.filtered_count) {
            const badge = document.querySelector('.felix-info-badge');
            if (badge) {
                badge.innerHTML = `
                    <i class="fas fa-chart-line"></i>
                    –ê–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ ${data.filtered_count} –∑–∞–ø–∏—Å–µ–π
                `;
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        updateStatusBar('real');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤ loadFelixPilaPrediction:', error);
        displayPrediction(null, true, true);
    }
}

/**
 * –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ü–†–û–ì–ù–û–ó–ê (—Ä–∞–±–æ—á–∞—è)
 */
function displayPrediction(prediction, noData = false, filtersApplied = false) {
    console.log("üé® displayPrediction –≤—ã–∑–≤–∞–Ω–∞ —Å:", { 
        prediction, 
        noData, 
        filtersApplied 
    });
    
    const container = document.getElementById('weatherPrediction');
    container.innerHTML = '';
    
    if (noData) {
        let message = '';
        
        if (filtersApplied) {
            message = `
                <div style="text-align: center; padding: 40px 20px; color: #718096; grid-column: span 2;">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px; color: #f39c12;"></i>
                    <h3 style="color: #e74c3c; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
                    </h3>
                    <p>–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–≥–æ–¥—ã.</p>
                    <p style="font-size: 0.9rem; margin-top: 15px; color: #95a5a6;">
                        <i class="fas fa-lightbulb"></i> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </p>
                    <button onclick="resetFelixFilters()" style="margin-top: 20px; padding: 10px 20px; 
                            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); 
                            color: white; border: none; border-radius: 8px; cursor: pointer;
                            font-weight: 500;">
                        <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                </div>
            `;
        } else {
            message = `
                <div style="text-align: center; padding: 40px 20px; color: #718096; grid-column: span 2;">
                    <i class="fas fa-database" style="font-size: 3rem; margin-bottom: 20px; color: #f39c12;"></i>
                    <h3 style="color: #e74c3c; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> –î–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
                    </h3>
                    <p>–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</p>
                    <p style="font-size: 0.9rem; margin-top: 15px; color: #95a5a6;">
                        <i class="fas fa-lightbulb"></i> –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
                    </p>
                </div>
            `;
        }
        
        container.innerHTML = message;
        return;
    }
    
    // –í–ê–ñ–ù–û: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç prediction.field_1 –∏ prediction.field_2 –∫–∞–∫ –º–∞—Å—Å–∏–≤—ã –æ–±—ä–µ–∫—Ç–æ–≤
    console.log("üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ prediction:", prediction);
    console.log("üéØ field_1 —Ç–∏–ø:", typeof prediction.field_1, "–∑–Ω–∞—á–µ–Ω–∏–µ:", prediction.field_1);
    console.log("üéØ field_2 —Ç–∏–ø:", typeof prediction.field_2, "–∑–Ω–∞—á–µ–Ω–∏–µ:", prediction.field_2);
    
    // –ü–æ–ª—É—á–∞–µ–º —á–∏—Å–ª–∞ –¥–ª—è –ø–æ–ª–µ–π (–∏–∑ API –ø—Ä–∏—Ö–æ–¥—è—Ç –æ–±—ä–µ–∫—Ç—ã {number: X, probability: Y})
    const field1 = prediction.field_1 || [];
    const field2 = prediction.field_2 || [];
    
    console.log("üéØ field_1 –¥–ª–∏–Ω–∞:", field1.length, "–¥–∞–Ω–Ω—ã–µ:", field1);
    console.log("üéØ field_2 –¥–ª–∏–Ω–∞:", field2.length, "–¥–∞–Ω–Ω—ã–µ:", field2);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –¥–∞–Ω–Ω—ã–µ
    if (field1.length === 0 && field2.length === 0) {
        console.log("‚ö†Ô∏è –û–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ");
        container.innerHTML = `
            <div style="text-align: center; padding: 30px; color: #718096; grid-column: span 2;">
                <i class="fas fa-search" style="font-size: 2rem;"></i>
                <p style="margin-top: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                <p style="font-size: 0.8rem; color: #95a5a6;">(–ø–æ–ª—è field_1 –∏ field_2 –ø—É—Å—Ç—ã–µ)</p>
            </div>
        `;
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º grid-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–≤—É—Ö –ø–æ–ª–µ–π
    const gridContainer = document.createElement('div');
    gridContainer.className = 'prediction-grid';
    container.appendChild(gridContainer);
    
    // –ü–æ–ª–µ 1 (—Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–µ)
    if (field1.length > 0) {
        console.log("üé® –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ 1 —Å", field1.length, "—á–∏—Å–ª–∞–º–∏");
        const field1Container = document.createElement('div');
        field1Container.className = 'field-container field-1';
        field1Container.innerHTML = `
            <div class="field-title">
                <i class="fas fa-star" style="color: #9b59b6;"></i>
                <span>–ü–æ–ª–µ 1</span>
            </div>
            <div class="field-numbers" id="field1Numbers"></div>
        `;
        gridContainer.appendChild(field1Container);
        
        const field1Numbers = field1Container.querySelector('#field1Numbers');
        
        field1.forEach((item, index) => {
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
            let numValue, numProb;
            
            if (typeof item === 'object' && item !== null) {
                // –§–æ—Ä–º–∞—Ç: {number: X, probability: Y}
                numValue = item.number;
                numProb = item.probability || 70;
            } else if (typeof item === 'number') {
                // –§–æ—Ä–º–∞—Ç: –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ
                numValue = item;
                numProb = 70;
            } else {
                // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                console.warn("‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ field_1:", item);
                numValue = '?';
                numProb = 0;
            }
            
            console.log(`   ‚Üí –ß–∏—Å–ª–æ ${index + 1}: ${numValue} (${numProb}%)`);
            
            const numDiv = document.createElement('div');
            numDiv.className = 'felix-number-item';
            numDiv.innerHTML = `
                <div class="felix-number-rank">${index + 1}</div>
                <div class="felix-number-value">${numValue}</div>
                <div class="felix-number-prob">${numProb}%</div>
            `;
            field1Numbers.appendChild(numDiv);
        });
    } else {
        console.log("‚ö†Ô∏è –ü–æ–ª–µ 1 –ø—É—Å—Ç–æ–µ");
    }
    
    // –ü–æ–ª–µ 2 (—Å–∏–Ω–µ–µ)
    if (field2.length > 0) {
        console.log("üé® –°–æ–∑–¥–∞–µ–º –ø–æ–ª–µ 2 —Å", field2.length, "—á–∏—Å–ª–∞–º–∏");
        const field2Container = document.createElement('div');
        field2Container.className = 'field-container field-2';
        field2Container.innerHTML = `
            <div class="field-title">
                <i class="fas fa-star" style="color: #3498db;"></i>
                <span>–ü–æ–ª–µ 2</span>
            </div>
            <div class="field-numbers" id="field2Numbers"></div>
        `;
        gridContainer.appendChild(field2Container);
        
        const field2Numbers = field2Container.querySelector('#field2Numbers');
        
        field2.forEach((item, index) => {
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
            let numValue, numProb;
            
            if (typeof item === 'object' && item !== null) {
                numValue = item.number;
                numProb = item.probability || 70;
            } else if (typeof item === 'number') {
                numValue = item;
                numProb = 70;
            } else {
                console.warn("‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ field_2:", item);
                numValue = '?';
                numProb = 0;
            }
            
            console.log(`   ‚Üí –ß–∏—Å–ª–æ ${index + 1}: ${numValue} (${numProb}%)`);
            
            const numDiv = document.createElement('div');
            numDiv.className = 'felix-number-item';
            numDiv.innerHTML = `
                <div class="felix-number-rank">${index + 1}</div>
                <div class="felix-number-value">${numValue}</div>
                <div class="felix-number-prob">${numProb}%</div>
            `;
            field2Numbers.appendChild(numDiv);
        });
    } else {
        console.log("‚ö†Ô∏è –ü–æ–ª–µ 2 –ø—É—Å—Ç–æ–µ");
    }
    
    // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    if (field1.length === 0 && field2.length === 0) {
        gridContainer.innerHTML = `
            <div class="field-container" style="text-align: center; padding: 30px; grid-column: span 2;">
                <i class="fas fa-chart-line" style="font-size: 2rem; color: #f39c12; margin-bottom: 15px;"></i>
                <h3 style="color: #4a5568;">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</h3>
                <p style="color: #718096;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤</p>
            </div>
        `;
    }
    
    console.log("‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
}

// –ë–õ–û–ö 5: –§–£–ù–ö–¶–ò–ò –ò–ù–°–ê–ô–¢–û–í
async function loadInsights() {
    try {
        const response = await fetch('/api/felix-pila/analysis');
        
        if (response.ok) {
            const data = await response.json();
            
            if (data.success) {
                displayInsights(data.analysis);
                return;
            }
        }
        
        // –î–ï–ú–û-–ò–ù–°–ê–ô–¢–´
        showDemoInsights();
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–æ–≤:', error);
        showDemoInsights();
    }
}

function displayInsights(analysis) {
    console.log("üéØ displayInsights –≤—ã–∑–≤–∞–Ω–∞ —Å:", analysis);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
    const highHumidityEl = document.getElementById('highHumidityNumbers');
    const highPressureEl = document.getElementById('highPressureNumbers');
    const strongWindEl = document.getElementById('strongWindNumbers');
    const fullMoonEl = document.getElementById('fullMoonNumbers');
    
    if (!highHumidityEl || !highPressureEl || !strongWindEl || !fullMoonEl) {
        console.error("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Å–∞–π—Ç–æ–≤");
        return;
    }
    
    if (analysis.by_humidity?.high?.field_1) {
        highHumidityEl.innerHTML = renderNumbers(analysis.by_humidity.high.field_1);
    } else {
        highHumidityEl.innerHTML = '<span style="color: #718096;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>';
    }
    
    if (analysis.by_pressure?.high?.field_1) {
        highPressureEl.innerHTML = renderNumbers(analysis.by_pressure.high.field_1);
    } else {
        highPressureEl.innerHTML = '<span style="color: #718096;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>';
    }
    
    if (analysis.by_weather?.sunny?.field_1) {
        strongWindEl.innerHTML = renderNumbers(analysis.by_weather.sunny.field_1);
    } else {
        strongWindEl.innerHTML = '<span style="color: #718096;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>';
    }
    
    if (analysis.by_temperature?.warm?.field_1) {
        fullMoonEl.innerHTML = renderNumbers(analysis.by_temperature.warm.field_1);
    } else {
        fullMoonEl.innerHTML = '<span style="color: #718096;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>';
    }
}

function showDemoInsights() {
    document.getElementById('highHumidityNumbers').innerHTML = renderNumbers([5, 9, 13, 17, 20]);
    document.getElementById('highPressureNumbers').innerHTML = renderNumbers([2, 6, 10, 14, 18]);
    document.getElementById('strongWindNumbers').innerHTML = renderNumbers([3, 7, 11, 15, 19]);
    document.getElementById('fullMoonNumbers').innerHTML = renderNumbers([1, 4, 8, 12, 16]);
}

// –ë–õ–û–ö 6: –§–£–ù–ö–¶–ò–ò –ê–ù–ê–õ–ò–ó–ê –° –§–ò–õ–¨–¢–†–ê–ú–ò –ò –ì–†–ê–§–ò–ö–ê
/**
 * –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ê–ù–ê–õ–ò–ó–ê –° –§–ò–õ–¨–¢–†–ê–ú–ò
 */
async function loadAnalysisWithFilters() {
    console.log("üéØ loadAnalysisWithFilters: –¢–û–õ–¨–ö–û –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏");
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    document.getElementById('weatherPrediction').innerHTML = `
        <div class="loading-state" style="grid-column: span 2;">
            <div class="loading-spinner"></div>
            <p>–ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã...</p>
        </div>
    `;
    
    try {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
        const weatherFilter = document.getElementById('weatherFilter').value;
        const tempFilter = document.getElementById('tempFilter').value;
        const humidityFilter = document.getElementById('humidityFilter').value;
        const pressureFilter = document.getElementById('pressureFilter').value;
        const windSpeedFilter = document.getElementById('windSpeedFilter').value;
        const windDirFilter = document.getElementById('windDirectionFilter').value;
        const moonFilter = document.getElementById('moonFilter').value;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º - –≤—ã–±—Ä–∞–Ω—ã –ª–∏ –≤–æ–æ–±—â–µ —Ñ–∏–ª—å—Ç—Ä—ã?
        const anyFilters = weatherFilter || tempFilter || humidityFilter || 
                          pressureFilter || windSpeedFilter || windDirFilter || moonFilter;
        
        if (!anyFilters) {
            // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –ù–ï –≤—ã–±—Ä–∞–Ω—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑
            console.log("‚ö†Ô∏è –§–∏–ª—å—Ç—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑");
            await loadFelixPilaPrediction();
            return;
        }
        
        // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã –≤—ã–±—Ä–∞–Ω—ã - –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å —Å –Ω–∏–º–∏
        const params = new URLSearchParams();
        if (weatherFilter) params.append('weather', weatherFilter);
        if (tempFilter) params.append('temp', tempFilter);
        if (humidityFilter) params.append('humidity', humidityFilter);
        if (pressureFilter) params.append('pressure', pressureFilter);
        if (windSpeedFilter) params.append('wind_speed', windSpeedFilter);
        if (windDirFilter) params.append('wind_dir', windDirFilter);
        if (moonFilter) params.append('moon', moonFilter);
        
        console.log(`üîç –ó–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏: ${params.toString()}`);
        
        // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –∏ –∞–Ω–∞–ª–∏–∑
        const [predictionResponse, analysisResponse] = await Promise.all([
            fetch(`/api/felix-pila/predict?${params}`),
            fetch(`/api/felix-pila/analysis?${params}`)
        ]);
        
        const predictionData = await predictionResponse.json();
        const analysisData = await analysisResponse.json();
        
        console.log("üìä –û—Ç–≤–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:", predictionData);
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑
        if (!predictionData.has_data || !predictionData.prediction) {
            displayPrediction(null, true, true);
            
            // –û–ë–ù–û–í–õ–Ø–ï–ú –¢–û–ß–ù–û–°–¢–¨ –° –ó–ê–î–ï–†–ñ–ö–û–ô
            setTimeout(() => {
                const accuracyScoreEl = document.getElementById('accuracyScore');
                const accuracyTextEl = document.getElementById('accuracyText');
                
                if (accuracyScoreEl) {
                    accuracyScoreEl.textContent = '0%';
                }
                if (accuracyTextEl) {
                    accuracyTextEl.textContent = '–¢–æ—á–Ω–æ—Å—Ç—å: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                }
            }, 100);
            
        } else {
            displayPrediction(predictionData.prediction);
            
            // –û–ë–ù–û–í–õ–Ø–ï–ú –¢–û–ß–ù–û–°–¢–¨ –° –ó–ê–î–ï–†–ñ–ö–û–ô
            setTimeout(() => {
                const accuracyScoreEl = document.getElementById('accuracyScore');
                const accuracyTextEl = document.getElementById('accuracyText');
                
                if (accuracyScoreEl) {
                    accuracyScoreEl.textContent = Math.round(predictionData.confidence * 100) + '%';
                }
                if (accuracyTextEl) {
                    accuracyTextEl.textContent = `–¢–æ—á–Ω–æ—Å—Ç—å: ${Math.round(predictionData.confidence * 100)}%`;
                }
            }, 100);
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–Ω—Å–∞–π—Ç—ã
        if (analysisData.has_data && analysisData.analysis) {
            const insights = analysisData.analysis;
            
            if (insights.by_humidity?.high?.field_1) {
                document.getElementById('highHumidityNumbers').innerHTML = 
                    renderNumbers(insights.by_humidity.high.field_1);
            }
            
            if (insights.by_pressure?.high?.field_1) {
                document.getElementById('highPressureNumbers').innerHTML = 
                    renderNumbers(insights.by_pressure.high.field_1);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂
            const badge = document.querySelector('.felix-info-badge');
            if (badge && analysisData.filtered_count) {
                badge.innerHTML = `
                    <i class="fas fa-filter"></i>
                    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${analysisData.filtered_count} –∑–∞–ø–∏—Å–µ–π
                `;
            }
        } else {
            document.getElementById('highHumidityNumbers').innerHTML = 
                '<span style="color: #718096;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>';
            document.getElementById('highPressureNumbers').innerHTML = 
                '<span style="color: #718096;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
        showDemoChart();
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:', error);
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑
        await loadFelixPilaPrediction();
    }
}

/**
 * –§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –î–ï–ú–û-–ì–†–ê–§–ò–ö–ê
 */
function showDemoChart() {
    const ctx = document.getElementById('analysisChart').getContext('2d');
    
    if (window.analysisChart) {
        window.analysisChart.destroy();
    }
    
    window.analysisChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['1-5', '6-10', '11-15', '16-20'],
            datasets: [{
                label: '–ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–∞–¥–µ–Ω–∏—è',
                data: [65, 59, 80, 71],
                backgroundColor: [
                    'rgba(155, 89, 182, 0.7)',  // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
                    'rgba(52, 152, 219, 0.7)',  // —Å–∏–Ω–∏–π
                    'rgba(46, 204, 113, 0.7)',  // –∑–µ–ª–µ–Ω—ã–π
                    'rgba(243, 156, 18, 0.7)'   // –æ—Ä–∞–Ω–∂–µ–≤—ã–π
                ],
                borderColor: [
                    'rgb(155, 89, 182)',
                    'rgb(52, 152, 219)',
                    'rgb(46, 204, 113)',
                    'rgb(243, 156, 18)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            }
        }
    });
}

// –ë–õ–û–ö 7: –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø
/**
 * –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –í–°–ï–• –î–ê–ù–ù–´–•
 */
async function refreshAllData() {
    console.log("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö...");
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ
    document.getElementById('weatherPrediction').innerHTML = `
        <div class="loading-state" style="grid-column: span 2;">
            <div class="loading-spinner"></div>
            <p>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>
    `;
    
    // –¢–û–õ–¨–ö–û –ø—Ä–æ–≥–Ω–æ–∑
    await loadFelixPilaPrediction();
    
    // –ò–Ω—Å–∞–π—Ç—ã –≤ —Ñ–æ–Ω–µ
    loadInsights().catch(e => console.log("–û—à–∏–±–∫–∞ –∏–Ω—Å–∞–π—Ç–æ–≤:", e));
    
    console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã");
}

/**
 * –§–£–ù–ö–¶–ò–Ø –°–ë–†–û–°–ê –§–ò–õ–¨–¢–†–û–í
 */
function resetFelixFilters() {
    console.log("üîÑ –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤");
    document.getElementById('weatherFilter').value = '';
    document.getElementById('tempFilter').value = '';
    document.getElementById('humidityFilter').value = '';
    document.getElementById('pressureFilter').value = '';
    document.getElementById('windSpeedFilter').value = '';
    document.getElementById('windDirectionFilter').value = '';
    document.getElementById('moonFilter').value = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑
    loadFelixPilaPrediction();
}

// –ë–õ–û–ö 8: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
document.addEventListener('DOMContentLoaded', async function() {
    console.log("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Felix Pila");
    
    // 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤ –ø–æ–≥–æ–¥—ã –ü–ï–†–í–´–ú –î–ï–õ–û–ú
    await loadWeatherTypes();
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
    await checkDataSources();
    
    // 3. –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥–Ω–æ–∑
    await loadFelixPilaPrediction();
    
    // 4. –ò–Ω—Å–∞–π—Ç—ã –≤ —Ñ–æ–Ω–µ
    setTimeout(() => {
        loadInsights().catch(e => console.log("–ò–Ω—Å–∞–π—Ç—ã:", e));
    }, 1000);
    
    // 5. –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
    window.resetFelixFilters = resetFelixFilters;
    window.refreshAllData = async function() {
        console.log("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö");
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∏–ø—ã –ø–æ–≥–æ–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑
        await loadWeatherTypes();
        await loadFelixPilaPrediction();
        setTimeout(() => {
            loadInsights().catch(e => console.log("–ò–Ω—Å–∞–π—Ç—ã:", e));
        }, 500);
    };
    
    // –¢–æ–ª—å–∫–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏!
    window.applyAnalysis = loadAnalysisWithFilters;
    
    console.log("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
});

// === –ö–û–ù–ï–¶ JavaScript –ö–û–î–ê ===
</script>
{% endblock %}